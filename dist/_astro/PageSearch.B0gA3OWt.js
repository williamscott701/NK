import{j as t}from"./jsx-runtime.C9eWo9jt.js";import{r as a}from"./index.B52nOzfP.js";function z({placeholder:N="Search...",booksData:m,storiesData:h,conceptsData:x,searchMode:i="all",onSearchResults:v}){const[c,C]=a.useState(""),[S,y]=a.useState(!1),[p,f]=a.useState([]),[j,g]=a.useState(!1),[d,L]=a.useState({top:0,left:0,width:0}),w=a.useRef(null);a.useEffect(()=>{const s=()=>{if(w.current){const r=w.current.getBoundingClientRect();L({top:r.bottom+window.scrollY,left:r.left+window.scrollX,width:r.width})}};return s(),window.addEventListener("resize",s),window.addEventListener("scroll",s),()=>{window.removeEventListener("resize",s),window.removeEventListener("scroll",s)}},[]);const $=s=>{if(!s.trim()){f([]),g(!1);return}console.log("Searching for:",s,"in mode:",i),console.log("Books data received:",m),console.log("Stories data received:",h),console.log("Concepts data received:",x);const r=[],o=s.toLowerCase();try{if(m&&(i==="all"||i==="books")){const n=m.books||m;console.log("Books array to search:",n),n.forEach(e=>{e.name.toLowerCase().includes(o)&&(console.log("Found matching book:",e.name),r.push({type:"book",title:e.name,description:e.description,url:`/book/${e.id}`,relevance:10})),e.author&&e.author.toLowerCase().includes(o)&&(console.log("Found book by author:",e.name,"by",e.author),r.push({type:"book",title:`${e.name} - by ${e.author}`,description:e.description,url:`/book/${e.id}`,relevance:9})),e.themes&&e.themes.some(l=>l.toLowerCase().includes(o))&&(console.log("Found book with matching theme:",e.name),r.push({type:"book",title:`${e.name} - Themes`,description:`Contains themes: ${e.themes.join(", ")}`,url:`/book/${e.id}`,relevance:8})),e.chaptersContent&&e.chaptersContent.forEach(l=>{(l.title&&l.title.toLowerCase().includes(o)||l.summary&&l.summary.toLowerCase().includes(o)||l.themes&&l.themes.some(b=>b.toLowerCase().includes(o)))&&(console.log("Found matching chapter:",`${e.name} Chapter ${l.number}`),r.push({type:"chapter",title:`${e.name} - Chapter ${l.number}`,description:l.title||l.summary||"",url:`/book/${e.id}/chapter/${l.number}`,relevance:7}))})})}if(h&&(i==="all"||i==="stories")){const n=h.stories||h;console.log("Searching in stories:",n),Array.isArray(n)&&n.forEach(e=>{e.title&&e.title.toLowerCase().includes(o)&&(console.log("Found matching story:",e.title),r.push({type:"story",title:e.title,description:e.summary,url:`/story/${e.id}`,relevance:9})),e.summary&&e.summary.toLowerCase().includes(o)&&(console.log("Found story with matching summary:",e.title),r.push({type:"story",title:e.title,description:e.summary,url:`/story/${e.id}`,relevance:8})),e.themes&&e.themes.some(l=>l.toLowerCase().includes(o))&&(console.log("Found story with matching theme:",e.title),r.push({type:"story",title:`${e.title} - Themes`,description:`Contains themes: ${e.themes.join(", ")}`,url:`/story/${e.id}`,relevance:7})),e.book&&e.book.toLowerCase().includes(o)&&(console.log("Found story in book:",e.title,"in",e.book),r.push({type:"story",title:`${e.title} - in ${e.book}`,description:e.summary,url:`/story/${e.id}`,relevance:8}))})}if(x&&(i==="all"||i==="concepts")){const n=x.concepts||x;console.log("Searching in concepts:",n),Array.isArray(n)&&n.forEach(e=>{e.title&&e.title.toLowerCase().includes(o)&&(console.log("Found matching concept:",e.title),r.push({type:"concept",title:e.title,description:e.description,url:`/concept/${e.id}`,relevance:10})),e.description&&e.description.toLowerCase().includes(o)&&(console.log("Found concept with matching description:",e.title),r.push({type:"concept",title:e.title,description:e.description,url:`/concept/${e.id}`,relevance:8}))})}console.log("All search results:",r);const u=r.filter((n,e,l)=>e===l.findIndex(b=>b.url===n.url));u.sort((n,e)=>e.relevance-n.relevance),console.log("Final unique results:",u),f(u.slice(0,10)),g(!0),v&&v(u)}catch(u){console.error("Search error:",u),f([])}};a.useEffect(()=>{c.trim()?$(c):(f([]),g(!1))},[c,m,h,x,i]);const F=s=>{s.preventDefault(),c.trim()&&$(c)},E=s=>{switch(s){case"book":return"ðŸ“–";case"chapter":return"ðŸ“„";case"story":return"ðŸ“š";case"concept":return"ðŸ§ ";default:return"ðŸ”"}},B=s=>{switch(s){case"book":return"bg-blue-100 text-blue-800 border-blue-200";case"chapter":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"story":return"bg-green-100 text-green-800 border-green-200";case"concept":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return t.jsxs("div",{className:"w-full max-w-2xl mx-auto mb-8 relative z-[9998]",ref:w,children:[t.jsx("form",{onSubmit:F,className:"relative",children:t.jsxs("div",{className:`relative transition-all duration-300 ${S?"transform scale-105":""}`,children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-bible-gold/10 to-bible-blue/10 rounded-xl blur-lg"}),t.jsx("div",{className:"relative bg-white/90 backdrop-blur-sm border border-white/20 rounded-xl shadow-lg overflow-hidden",children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-center p-3 sm:p-4 gap-3 sm:gap-0",children:[t.jsxs("div",{className:"flex items-center w-full sm:w-auto flex-1",children:[t.jsx("svg",{className:"w-5 h-5 text-bible-blue mr-3 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),t.jsx("input",{type:"text",value:c,onChange:s=>C(s.target.value),onFocus:()=>y(!0),onBlur:()=>{y(!1),setTimeout(()=>g(!1),200)},placeholder:i==="all"?N:i==="stories"?"Search stories...":i==="concepts"?"Search concepts...":"Search books...",className:"flex-1 text-base sm:text-lg text-gray-800 placeholder-gray-500 bg-transparent outline-none w-full"})]}),t.jsx("button",{type:"submit",className:"w-full sm:w-auto px-4 sm:px-6 py-2 bg-gradient-to-r from-bible-blue to-blue-600 text-white font-semibold rounded-lg hover:from-bible-blue/90 hover:to-blue-600/90 transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 text-sm sm:text-base",children:"Search"})]})})]})}),j&&p.length>0&&t.jsx("div",{className:"fixed inset-0 z-[9999] pointer-events-none",children:t.jsx("div",{className:"absolute bg-white rounded-xl shadow-2xl border border-gray-200 max-h-96 overflow-y-auto pointer-events-auto mx-4 sm:mx-0",style:{top:`${d.top+8}px`,left:window.innerWidth<640?"16px":`${d.left}px`,width:window.innerWidth<640?"calc(100vw - 32px)":`${d.width}px`},children:t.jsxs("div",{className:"p-3 sm:p-4",children:[t.jsxs("div",{className:"text-sm text-gray-500 mb-3 px-2 flex items-center justify-between",children:[t.jsxs("span",{children:["Found ",p.length," results"]}),i!=="all"&&t.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded-full font-medium",children:i==="stories"?"ðŸ“š Stories only":i==="concepts"?"ðŸ’¡ Concepts only":i==="books"?"ðŸ“– Books only":""})]}),p.map((s,r)=>t.jsx("a",{href:s.url,className:"block p-2 sm:p-3 rounded-lg hover:bg-gray-50 transition-colors duration-200 border-b border-gray-100 last:border-b-0",children:t.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[t.jsx("span",{className:"text-xl sm:text-2xl",children:E(s.type)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("h4",{className:"font-semibold text-gray-900 truncate text-sm sm:text-base",children:s.title}),t.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full border ${B(s.type)}`,children:s.type})]}),t.jsx("p",{className:"text-xs sm:text-sm text-gray-600 line-clamp-2",children:s.description})]})]})},r))]})})}),j&&c.trim()&&p.length===0&&t.jsx("div",{className:"fixed inset-0 z-[9999] pointer-events-none",children:t.jsx("div",{className:"absolute bg-white rounded-xl shadow-2xl border border-gray-200 p-4 sm:p-6 pointer-events-auto mx-4 sm:mx-0",style:{top:`${d.top+8}px`,left:window.innerWidth<640?"16px":`${d.left}px`,width:window.innerWidth<640?"calc(100vw - 32px)":`${d.width}px`},children:t.jsxs("div",{className:"text-center text-gray-500",children:[t.jsx("div",{className:"text-3xl sm:text-4xl mb-2",children:"ðŸ”"}),t.jsx("p",{className:"text-base sm:text-lg font-medium mb-2",children:"No results found"}),t.jsx("p",{className:"text-xs sm:text-sm",children:"Try searching for different keywords"})]})})})]})}export{z as default};
